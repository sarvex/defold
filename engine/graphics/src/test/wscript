#! /usr/bin/env python

from waf_dynamo import platform_supports_feature

def build(bld):
    for name in ['test_graphics', 'test_glsl_uniform_parser']:
        bld.program(
            features='cxx cprogram test',
            includes=['../../src', '../../proto'],
            exported_symbols=['GraphicsAdapterNull'],
            source=f'{name}.cpp',
            use='TESTMAIN DDF DLIB PLATFORM_SOCKET PROFILE_NULL graphics_null graphics_transcoder_null',
            target=name,
        )

    if platform_supports_feature(
        bld.env.PLATFORM, 'vulkan', {}
    ) and bld.env.PLATFORM not in ('x86_64-linux', 'x86_64-ios'):

        extra_libs = []
        if bld.env.PLATFORM in ('armv7-android', 'arm64-android'):
            extra_libs += ['OPENGL']

        bld.program(features = 'cxx cprogram test skip_test',
                    includes = ['../../src', '../../proto'],
                    exported_symbols = ['GraphicsAdapterVulkan'],
                    source = 'test_app_vulkan.cpp',
                    use = 'TESTMAIN PLATFORM DDF DLIB DMGLFW PROFILE GRAPHICS_VULKAN VULKAN graphics_vulkan graphics_transcoder_basisu'.split() + extra_libs,
                    target = 'test_app_vulkan')
